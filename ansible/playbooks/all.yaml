---
- hosts: all
  become: true

  tasks:
    - name: update package cache
      ansible.builtin.package:
        update_cache: true

- hosts: pki
  become: true

  roles:
    - pki

- hosts: etcd
  become: true

  roles:
    - etcd

- hosts: jumphost
  become: true

  roles:
    - kube_admin

- hosts: apiserver
  become: true

  roles:
    - kube_apiserver

- hosts: managers
  become: true

  roles:
    - kube_controller_manager
    - kube_scheduler

- hosts: workers
  become: true

  roles:
    - containerd
    - kubelet
